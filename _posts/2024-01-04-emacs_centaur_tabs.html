---
layout: blogpost
title: "Emacs package highlight - Centaur Tabs - The best tab (UI) system for Emacs!"
tags: emacs editor
related_tags_count: 1
preview_image: assets/img/backenddev/backend.png
---

<p>
My relationship with tabs as a UI element is a bit ambivalent. I really enjoy tabs in web browsers, except maybe the missing option to group tabs in most browsers. In most editors and Integrated Developer Environments (IDEs) I have tried through the years, they never feel enjoyable to me. That might be because I have very specific needs and opinions on how things should work. Last autumn, I found an Emacs package called centaur-tabs and have been using it ever since. So far, it is the only tab package I have enjoyed! Continue reading to see why.
</p>



<p>
This should not need to be mentioned, but I use Emacs for ME! If you don't like a package, that is okay. My hope is to inspire you to try new packages that I enjoy. I don't give a shit if Emacs maintainers, your mom, the pope, or someone else hate a package I use. People will always have different opinions. I got a lot of flack by one guy in my YouTube comments when mentioning Helm, as he thought it was trash, with the proof being that none of the top Emacs maintainers use it or contribute to it. He did not enjoy that it overrides a lot of standard Emacs behavior either, but that is what I REALLY enjoy about it. As said by Howard Roark in The Fountainhead by Ayn Rand (movie version): 
</p>
<p class="verse">
"MY work done MY way, nothing else matters to me"<br />
</p>
<p>
(feel free to read <a href="https://themkat.net/2021/09/22/essential_ayn_rand.html">my article on recommended books by Ayn Rand</a> if you are curious)
</p>


<p>
<b>NB! Packages might change, and this article covers how the package worked at January 4th 2024. You can find <a href="https://github.com/themkat/.emacs.d">my up-to-date Emacs configuration on Github</a>. Search for centaur-tabs, and you will see the config if I still use the package in the future.</b>
</p>


<div id="outline-container-orga8726ec" class="outline-2">
<h2 id="orga8726ec">What I expect from tab packages</h2>
<div class="outline-text-2" id="text-orga8726ec">
<p>
Many years ago I tried other tab packages in Emacs, and didn't really enjoy them that much. As I experiment with them many years ago, I do not remember the specific package names. I remember the reasons for not enjoying them though:
</p>
<ul class="org-ul">
<li>Limited or missing customization options. This includes tab grouping, configuring how the tabs are navigated etc. Customizing packages to MY liking is paramount.</li>
<li>Unintuitive navigation and behavior.</li>
<li>Integration with other packages. While centaur-tabs is not perfect, it at least integrates with Helm, Ivy and Projectiles. I will share how I configure it to my liking below.</li>
<li>Not in active development.</li>
<li>Bugs.</li>
</ul>


<p>
Continue reading to see how I think <a href="https://github.com/ema2159/centaur-tabs">centaur-tabs</a> solves these issues.
</p>
</div>
</div>

<div id="outline-container-org18afa00" class="outline-2">
<h2 id="org18afa00">Introducing <a href="https://github.com/ema2159/centaur-tabs">centaur-tabs</a></h2>
<div class="outline-text-2" id="text-org18afa00">
<p>
Let us first see what the top tab bar looks like with centaur-tabs in my setup. Yours might look a bit more plain at first, but I will share some configuration options shortly (so don't worry!). Currently I'm editing this blog-post, while also having another post open as well as a terminal:
</p>
<img src="{{ "assets/img/centaurtabs/firstexample.png" | relative_url}}" alt="centaur-tabs with a few tabs open." class="blogpostimg" />

<p>
Now, let us try editing this blog post:
</p>
<img src="{{ "assets/img/centaurtabs/edited.png" | relative_url}}" alt="centaur-tabs when we edit contents the tab is showing." class="blogpostimg" />

<p>
Notice that we get the bolder text in the filename, as well as a filled circle to indicate that the buffer has been edited. 
</p>


<p>
You can navigate using the mouse if you want to as well, though I prefer not to.
</p>
</div>
</div>

<div id="outline-container-org8bffc1e" class="outline-2">
<h2 id="org8bffc1e">Configuration options</h2>
<div class="outline-text-2" id="text-org8bffc1e">
<p>
Activating centaur-tabs is as easy as running a function:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(centaur-tabs-mode 1)
</pre>
</div>

<p>
You are probably curious on what configuration options you need to make the tabs look as above&#x2026;? To get nice icons, we need the <a href="https://github.com/domtronn/all-the-icons.el">all-the-icons package</a> (remember to run <code>all-the-icons-install-fonts</code> or you will not have any icons!). To activate them, we simply set the corresponding variable:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setq centaur-tabs-set-icons t)
</pre>
</div>

<p>
By default, the icons are colored. I prefer them to be the same color as the text:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setq centaur-tabs-plain-icons t)
</pre>
</div>

<p>
Last, but not least we configure the highlighting of edited tabs:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setq centaur-tabs-set-modified-marker t)
</pre>
</div>

<p>
That is all you need to get the pretty tabs above!
</p>


<p>
There is a built in <a href="https://github.com/bbatsov/projectile">projectile</a> integration, though I had my own wishes for how it should work. It provides tab grouping where you only see tabs in the current projectile project, and everything else in a separate group (with minor deviations). This worked okay for a while, but had the issue of process tabs like terminals, Rust cargo runs using Rustic etc. running in a separate tab group than the project they started from. Sometimes this also affected untracked files in Git. See the next heading to see how I defined a custom function (still using projectile internals) to make it work the way I want.
</p>


<p>
If it is not clear how to switch between tab groups: This is completely up to you! I use Helm to switch between individual buffers that are open, which will also switch to other tab groups. Using helm-mini, it might look something like this:
</p>

<img src="{{ "assets/img/centaurtabs/tabgroups.gif" | relative_url}}" alt="centaur-tabs when using helm to switch between tab groups." class="blogpostimg" />
<p>
(notice that the visible tabs change based upon which project I am currently in)
</p>


<p>
There are many more configuration options, so see <a href="https://github.com/ema2159/centaur-tabs">the centaur-tabs github repo</a> for more information on them.
</p>
</div>
</div>


<div id="outline-container-orgbe37554" class="outline-2">
<h2 id="orgbe37554">Making tab-grouping work the way I want</h2>
<div class="outline-text-2" id="text-orgbe37554">
<p>
While the projectile integration is okay, it has the limits as described above. Buffers like the ones from <a href="https://github.com/akermu/emacs-libvterm">VTerm</a> (feel free to read <a href="https://themkat.net/2023/06/06/emacs_package_highlight_vterm.html">my article on vterm and why it is the best terminal solution inside Emacs</a>), Cargo Rustic runs etc. are shown in a separate group instead of the project they are part of. Projectile exposes some a function called <code>projectile-project-root</code> as well as a variable called <code>projectile-known-projects</code>. We can use this to ask projectile directly for the corresponding project root, and to create a fallback (some buffers were weird and stubborn, might not be needed in all cases):
</p>


<div class="org-src-container">
<pre class="src src-lisp">(defun centaur-tabs-buffer-groups ()
  "Groups tabs based on which project root they are in if possible"
  (let ((get-closest-projectile-project
	 (lambda (path)
	   (let ((expanded-path (f-long path)))
	     (-first (lambda (proj)
		       (s-starts-with? proj
				       expanded-path))
		     (-map (lambda (proj)
			     (f-long proj))
			   projectile-known-projects))))))
    (list (cond
	   ;; Group as part of projectile project if directly part of it
	   ((condition-case _err
		(projectile-project-root)
	      (error nil))
	    (f-expand (projectile-project-root)))
	   ;; Try to group as part of projectile project if indirectly part of it (started from the same directory, not yet tracked, or maybe temporary buffer)
	   ;; (useful for temporary buffers, vterm terminals started in same directory, rustic runs etc.)
	   (get-closest-projectile-project default-directory)
	   ((string-equal "*" (substring (buffer-name) 0 1))
	    "proc-buffers")
	   ;; ... other groupings ...
	   (t
	    "Other")))))
</pre>
</div>


<p>
The code above uses <a href="https://github.com/magnars/dash.el">dash.el</a> (for better list operations), <a href="https://github.com/magnars/s.el">s.el</a> (for better string operations) and <a href="https://github.com/rejeep/f.el">f.el</a> (for better file operations). I have previously written <a href="https://themkat.net/2022/10/03/emacs_lisp_better.html">an article on how these improve your Emacs Lisp experience significantly</a>!
</p>

<p>
(Like mentioned above, the inner function <code>get-closes-projectile-project</code>  might not be needed for you. I just found that some stubborn buffers were not grouped correctly without it. Might be a bug in projectile.)
</p>
</div>
</div>

<div id="outline-container-org7c11524" class="outline-2">
<h2 id="org7c11524">My complete configuration</h2>
<div class="outline-text-2" id="text-org7c11524">
<p>
I use <a href="https://github.com/jwiegley/use-package">use-package</a> to configure my Emacs packages. If you are unfamiliar with it, I suggest taking a quick look at it before reading my configuration below.
</p>

<div class="org-src-container">
<pre class="src src-lisp">;; Unset the default behavior of the C-x &lt;left&gt; and &lt;right&gt; arrow key navigation
(global-unset-key (kbd "C-x &lt;left&gt;"))
(global-unset-key (kbd "C-x &lt;right&gt;"))

(use-package centaur-tabs
  :after (dashboard org)

  :config
  (centaur-tabs-mode 1)

  (defun centaur-tabs-buffer-groups ()
    "Groups tabs based on which project root they are in if possible"
    (let ((get-closest-projectile-project
	   (lambda (path)
	     (let ((expanded-path (f-long path)))
	       (-first (lambda (proj)
			 (s-starts-with? proj
					 expanded-path))
		       (-map (lambda (proj)
			       (f-long proj))
			     projectile-known-projects))))))
      (list (cond
	     ;; Group as part of projectile project if directly part of it
	     ((condition-case _err
		  (projectile-project-root)
		(error nil))
	      (f-expand (projectile-project-root)))
	     ;; Try to group as part of projectile project if indirectly part of it (started from the same directory, not yet tracked, or maybe temporary buffer)
	     ;; (useful for temporary buffers, vterm terminals started in same directory, rustic runs etc.)
	     (get-closest-projectile-project default-directory)
	     ((string-equal "*" (substring (buffer-name) 0 1))
	      "proc-buffers")
	     ;; ... other groupings ...
	     (t
	      "Other")))))

  :custom
  (centaur-tabs-set-icons t)
  (centaur-tabs-plain-icons t)
  (centaur-tabs-set-modified-marker t)

  :bind
  (("C-x &lt;left&gt;" . centaur-tabs-backward-tab)
   ("C-x &lt;right&gt;" . centaur-tabs-forward-tab))

  :hook
  ((dashboard-mode . centaur-tabs-local-mode)
   (org-src-mode . centaur-tabs-local-mode)
   (calendar-mode . centaur-tabs-local-mode)))
</pre>
</div>

<p>
Notice that I override the default behavior of the <code>C-x &lt;arrow-key&gt;</code> key bindings. This is to only navigate within a given tab group for those key bindings. The regular way these key bindings work are weird, though I have used them a lot still. It is often not possible to know which buffer is the previous and next with the default behavior, but with the custom behavior above it is completely deterministic! (just the next visible tab, with looping).
</p>


<p>
You might also notice the hooks on <code>centaur-tabs-local-mode</code>. What is this? It simply removes the tab bar at the top when we are in these modes.
</p>


<p>
My configuration might change with time, and there are probably room for improvements (as always) :)
</p>
</div>
</div>
